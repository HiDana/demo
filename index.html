<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>FaceDetector</title>
	<style>
		* {
			box-sizing: border-box;
			padding: 0;
			margin: 0;
		}

		#container {
			position: absolute;
			width: 100%;
			height: auto;
			top: 50%;
			transform: translateY(-50%);
		}

		.landmark {
			width: 10px;
			height: 10px;
			position: absolute;
		}

		.mouth {
			width: 20px;
		}
	</style>
</head>

<body>
	<div id="container">
		<img id="face-image" alt="image" style="width: 100%;" />
	</div>

</body>

</html>
<script type="text/javascript">
	window.onload = main();
	function main() {
		const faceDetector = new FaceDetector({ fastMode: true, maxDetectedFaces: 10 });

		const image = document.getElementById('face-image');
		const container = document.getElementById('container');

		image.src = './IMG_5687.jpg'

		image.onload = function () {
			setTimeout(handleDetect, 100);
		};

		function handleDetect() {
			const rate = image.offsetWidth / image.naturalWidth;

			faceDetector.detect(image)
				.then(detectedFaces => {
					console.log(detectedFaces);
					for (const face of detectedFaces) {
						const { width, height, top, left } = face.boundingBox
						const faceBox = document.createElement('div');
						console.log(face.boundingBox);
						faceBox.style.position = 'absolute';
						faceBox.style.left = rate * face.boundingBox.x + 'px';
						faceBox.style.top = rate * face.boundingBox.y + 'px';
						faceBox.style.width = rate * face.boundingBox.width + 'px';
						faceBox.style.height = rate * face.boundingBox.height + 'px';
						faceBox.style.border = '2px solid #3AF4D5';


						//mouth
						face.landmarks.forEach(landmark => {
							const el = document.createElement('div');
							el.classList.add('landmark', landmark.type)
							el.style.cssText = `
							top: ${rate * (landmark.location.y - top)}px; 
							left: ${rate * (landmark.location.x - left)}px; 
							border:2px solid #FFFC56;
							`;
							faceBox.appendChild(el);
						})

						container.appendChild(faceBox);
						console.log(faceBox);

					}

					// for (const mouth of detectedFaces) {
					// 	const divMouth = document.createElement('div');
					// 	console.log(face.boundingBox);
					// 	divMouth.style.position = 'absolute';
					// 	divMouth.style.left = rate * face.boundingBox.x + 'px';
					// 	divMouth.style.top = rate * face.boundingBox.y + 'px';
					// 	divMouth.style.width = rate * face.boundingBox.width + 'px';
					// 	divMouth.style.height = rate * face.boundingBox.height + 'px';
					// 	divMouth.style.border = '2px solid #3AF4D5';
					// 	container.appendChild(divMouth);
					// }
				})
				.catch((e) => {
					console.error("Face Detection failed, boo.", e);
				});
		}
	}
</script>